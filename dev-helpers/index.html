<!-- HTML for dev server -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Swagger UI</title>
  <link rel="stylesheet" type="text/css" href="./swagger-ui.css" >
  <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16" />
  <style>
    html
    {
      box-sizing: border-box;
      overflow: -moz-scrollbars-vertical;
      overflow-y: scroll;
    }

    *,
    *:before,
    *:after
    {
      box-sizing: inherit;
    }

    body
    {
      margin:0;
      background: #fafafa;
    }
  </style>
</head>

<body>
  <div id="swagger-ui"></div>

  <div id="test-ele-outer"><div id="test-ele"></div></div>
  <!-- <div id="test-ele-outer"><div id="test-store"></div></div> -->

  <script src="./swagger-ui-bundle.js" charset="UTF-8"> </script>
  <script src="./swagger-ui-standalone-preset.js" charset="UTF-8"> </script>
  <script>
const CaseInsensitiveFilterPlugin = function (system) {
    return {
        fn: {
            opsFilter: (taggedOps, opsFilter) => {

                const paths = opsFilter.get('paths');
                const tags = opsFilter.get('tags');
                const methods = opsFilter.get('methods');

                console.log('taggedops', taggedOps);

                return taggedOps

                  .filter((tagObj, tag) => {
                    // filter out by tag
                    if (
                      tags && tags.size > 0 && !tags.some(t => t === tag)
                    ) {
                      return false
                    }

                    return true;
                  })
                  .updateIn(
                    tags,
                    (tagObj) => {
                      if (!tagObj) {
                        return tagObj;
                      }

                      return tagObj.update('operations', (ops) => {

                        return ops.update((ops) => {

                          for (let i = ops.size - 1; i >= 0; i--) {
                            const op = ops.get(i);

                            if (
                              !((
                                (
                                  !methods ||
                                  methods.size === 0 ||
                                  methods.some(method => op.get("method").toLowerCase().indexOf(method.toLowerCase()) !== -1)
                                )
                              ) &&
                              (
                                (
                                  !paths ||
                                  paths.size === 0 ||
                                  paths.some(path => op.get("path").toLowerCase().indexOf(path.toLowerCase()) !== -1))
                              ))
                            ) {
                              ops = ops.delete(i);
                            }
                          }

                          return ops;
                        });

                        return ops;
                      })

                      return tagObj
                    }
                  );

            }
        }
    }
};

    window.onload = function() {
      window["SwaggerUIBundle"] = window["swagger-ui-bundle"]
      window["SwaggerUIStandalonePreset"] = window["swagger-ui-standalone-preset"]
      // Build a system
      const ui = SwaggerUIBundle({
        url: "https://petstore.swagger.io/v2/swagger.json",
        dom_id: '#swagger-ui',
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        plugins: [
        CaseInsensitiveFilterPlugin,
        SwaggerUIBundle.plugins.DownloadUrl,

        ],
        filter: {paths: [], tags: ['pet'], methods: ['GET']},
        layout: "OperationsLayout",
        initOnly: true,
      })

      window.ui = ui

      ui.initOAuth({
        clientId: "your-client-id",
        clientSecret: "your-client-secret-if-required",
        realm: "your-realms",
        appName: "your-app-name",
        scopeSeparator: " ",
        scopes: "openid profile email phone address",
        additionalQueryStringParams: {},
        usePkceWithAuthorizationCodeGrant: false
      })

      ui.renderSingleTag(document.querySelector('#test-ele'), 'store', ['inventory'])
      // ui.renderSingleOperation('pet', document.querySelector('#test-store'))
    }
  </script>
</body>

</html>
